<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>CEDA Dashboard</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/icofont/icofont.min.css" rel="stylesheet">
  <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="assets/vendor/owl.carousel/assets/owl.carousel.min.css" rel="stylesheet">
  <link href="assets/vendor/venobox/venobox.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">


  <!-- =======================================================
  * Template Name: Appland - v3.0.0
  * Template URL: https://bootstrapmade.com/free-bootstrap-app-landing-page-template/
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
</head>
<style>
  /* Fade animation for the modal */
  .modal.fade .modal-dialog {
    transition: transform 0.3s ease-out, opacity 0.3s ease-out;
    transform: translate(0, -50px);
    opacity: 0;
  }

  .modal.fade.show .modal-dialog {
    transform: translate(0, 0);
    opacity: 1;
  }
</style>

<body>

  <!-- ======= Header ======= -->
  <header id="header" class="fixed-top  header-transparent ">
    <div class="container d-flex align-items-center justify-content-between">

      <div class="logo">
        <h1 class="text-light"><a href="index.html">CEDA</a></h1>
        <!-- Uncomment below if you prefer to use an image logo -->
        <!-- <a href="index.html"><img src="assets/img/logo.png" alt="" class="img-fluid"></a>-->
      </div>

      <nav class="nav-menu d-none d-lg-block">
        <ul>
          <li class="active"><a href="index.html">Home</a></li>
          <!-- <li><a href="#features">App Features</a></li>
          <li><a href="#gallery">Gallery</a></li>
          <li><a href="#pricing">Pricing</a></li>
          <li><a href="#faq">F.A.Q</a></li>
          <li><a href="#contact">Contact Us</a></li> -->

          <!-- <li class="get-started"><a href="#features">Get Started</a></li> -->
        </ul>
      </nav><!-- .nav-menu -->

    </div>
  </header><!-- End Header -->

  <!-- ======= Hero Section ======= -->
  <section id="hero" class="d-flex align-items-center">

    <div class="container">
      <div class="row">
        <div class="col-lg-6 d-lg-flex flex-lg-column justify-content-center align-items-stretch pt-5 pt-lg-0 order-2 order-lg-1" data-aos="fade-up">
          <div>
            <h1>CEDA Dashboard</h1>
            <h2>Lorem ipsum dolor sit amet, tota senserit percipitur ius ut, usu et fastidii forensibus voluptatibus. His ei nihil feugait</h2>
            <a href="#" class="download-btn"><i class="bx bxl-play-store"></i> Get Access</a>
            <a href="#" class="download-btn"><i class="bx bxl-apple"></i> API</a>
          </div>
        </div>
        <div class="col-lg-6 d-lg-flex flex-lg-column align-items-stretch order-1 order-lg-2 hero-img" data-aos="fade-up">
          <img src="assets/img/hero-img.png" class="img-fluid" alt="">
        </div>
      </div>
    </div>

  </section><!-- End Hero -->

  <main id="main">

    <!-- ======= App Features Section ======= -->
    <section id="features" class="features">
      <div class="container">
        <h2>Following is the plot</h2>
        <!-- Button to trigger the modal -->
        <button style="float:right;text-align: right;"  type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#myModal">
          Plot More Data
        </button>
      
        <!-- The Modal -->
        <div class="modal" id="myModal">
          <div class="modal-dialog">
            <div class="modal-content">
      
              <!-- Modal Header -->
              <div class="modal-header">
                <h4 class="modal-title">Plot More Data</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
      
              <!-- Modal Body -->
              <div class="modal-body">
                  <select class="form-select" id="indicator">
                    <option selected disabled>Select Indicator</option>
                    <option value="Assesable value">Assesable value</option>
                    <option value="Number of e-way bills">Number of e-way bills</option>
                    <option value="Number of suppliers">Number of suppliers</option>
                  </select><br />
  
                  <select class="form-select" id="direction">
                    <option selected disabled>Select Direction</option>
                    <option value="Incoming from other states">Incoming from other states</option>
                    <option value="Outgoing to other states">Outgoing to other states</option>
                    <option value="Within state">Within state</option>
                  </select><br />
                  <button class="btn btn-success" onclick="addToChart()">Add to Chart</button>
              </div>
      
              <!-- Modal Footer -->
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              </div>
      
            </div>
          </div>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

        <div id="my_dataviz" class="svg-container" style="overflow:scroll;margin:1px solid black"></div>
        <div id="alert-container">
          
        </div>
      </div>
      
    </section><!-- End App Features Section -->


  </main><!-- End #main -->

  <!-- ======= Footer ======= -->
  <footer id="footer">

    <div class="footer-newsletter" data-aos="fade-up">
      <div class="container">
        <div class="row justify-content-center">
          <div class="col-lg-6">
            <h4>Join Our Newsletter</h4>
            <p>Tamen quem nulla quae legam multos aute sint culpa legam noster magna</p>
            <form action="" method="post">
              <input type="email" name="email"><input type="submit" value="Subscribe">
            </form>
          </div>
        </div>
      </div>
    </div>

    <div class="footer-top">
      <div class="container">
        <div class="row">

          <div class="col-lg-3 col-md-6 footer-contact" data-aos="fade-up">
            <h3>Appland</h3>
            <p>
              A108 Adam Street <br>
              New York, NY 535022<br>
              United States <br><br>
              <strong>Phone:</strong> +1 5589 55488 55<br>
              <strong>Email:</strong> info@example.com<br>
            </p>
          </div>

          <div class="col-lg-3 col-md-6 footer-links" data-aos="fade-up" data-aos-delay="100">
            <h4>Useful Links</h4>
            <ul>
              <li><i class="bx bx-chevron-right"></i> <a href="#">Home</a></li>
              <li><i class="bx bx-chevron-right"></i> <a href="#">About us</a></li>
              <li><i class="bx bx-chevron-right"></i> <a href="#">Services</a></li>
              <li><i class="bx bx-chevron-right"></i> <a href="#">Terms of service</a></li>
              <li><i class="bx bx-chevron-right"></i> <a href="#">Privacy policy</a></li>
            </ul>
          </div>

          <div class="col-lg-3 col-md-6 footer-links" data-aos="fade-up" data-aos-delay="200">
            <h4>Our Services</h4>
            <ul>
              <li><i class="bx bx-chevron-right"></i> <a href="#">Web Design</a></li>
              <li><i class="bx bx-chevron-right"></i> <a href="#">Web Development</a></li>
              <li><i class="bx bx-chevron-right"></i> <a href="#">Product Management</a></li>
              <li><i class="bx bx-chevron-right"></i> <a href="#">Marketing</a></li>
              <li><i class="bx bx-chevron-right"></i> <a href="#">Graphic Design</a></li>
            </ul>
          </div>

          <div class="col-lg-3 col-md-6 footer-links" data-aos="fade-up" data-aos-delay="300">
            <h4>Our Social Networks</h4>
            <p>Cras fermentum odio eu feugiat lide par naso tierra videa magna derita valies</p>
            <div class="social-links mt-3">
              <a href="#" class="twitter"><i class="bx bxl-twitter"></i></a>
              <a href="#" class="facebook"><i class="bx bxl-facebook"></i></a>
              <a href="#" class="instagram"><i class="bx bxl-instagram"></i></a>
              <a href="#" class="google-plus"><i class="bx bxl-skype"></i></a>
              <a href="#" class="linkedin"><i class="bx bxl-linkedin"></i></a>
            </div>
          </div>

        </div>
      </div>
    </div>

    <div class="container py-4">
      <div class="copyright">
        &copy; Copyright <strong><span>Appland</span></strong>. All Rights Reserved
      </div>
      
    </div>
  </footer><!-- End Footer -->

  <a href="#" class="back-to-top"><i class="icofont-simple-up"></i></a>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/jquery/jquery.min.js"></script>
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/jquery.easing/jquery.easing.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script src="assets/vendor/owl.carousel/owl.carousel.min.js"></script>
  <script src="assets/vendor/venobox/venobox.min.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script>
    var parsedData;
    var lineFilters=[{'indicator':'Assessable value','direction':'Outgoing to other states'},{'indicator':'Number of suppliers','direction':'Outgoing to other states'}];
    function addToChart(){
      dir = document.getElementById("direction").value;
      ind = document.getElementById("indicator").value;
      addLine({'indicator':ind,'direction':dir})
    }

    function removeLine(obj){
        lineFilters.pop(obj);
          makeSVG(parsedData);
    }
    function addLine(obj){
          lineFilters.push(obj);
          makeSVG(parsedData);
    }
    var numLines=1;
    function makeSVG(parsedData){
             document.querySelector("#my_dataviz").innerHTML="";
             document.querySelector("#alert-container").innerHTML="<br /><br /><h5>Displaying charts:</h5>";
              // Set the dimensions and margins of the graph
              var margin = {top: 10, right: 30, bottom: 30, left: 60},
                  width = 960 - margin.left - margin.right,
                  height = 500 - margin.top - margin.bottom;
                
              var combinedData=[];
              for(var i=0;i<lineFilters.length;i++){
                var arr =(parsedData.filter(d => d.indicator == lineFilters[i].indicator));
                combinedData = combinedData.concat(arr);
              }
              console.log(lineFilters);

              // console.log(combinedData)
              // Append the svg object to the body of the page
              var svg = d3.select("#my_dataviz")
                .append("svg")
                  .attr("width", width + margin.left + margin.right)
                  .attr("height", height + margin.top + margin.bottom)
                .append("g")
                  .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
              
              // Add X axis -> it is a year scale with month slots
              var x = d3.scaleTime()
                .domain(d3.extent(combinedData, d => d.date))
                .range([0, width]);

              svg.append("g")
                .attr("transform", "translate(0," + height + ")")
                .call(d3.axisBottom(x).tickFormat(d3.timeFormat("%Y")));

              // Add Y axis
              var y = d3.scaleLinear()
                .domain([d3.min(combinedData, d => d.value) - 10, d3.max(combinedData, d => d.value)])
                .range([height, 0]);

              svg.append("g")
                .call(d3.axisLeft(y));

              for(var i=0;i<lineFilters.length;i++){
                var lineData = parsedData.filter(d => d.indicator == lineFilters[i].indicator && d.direction == lineFilters[i].direction);
                var line = d3.line()
                .x(d => x(d.date))
                .y(d => y(d.value));

                svg.append("path")
                  .datum(lineData)
                  .attr("fill", "none")
                  .attr("stroke", getRandomColor())
                  .attr("stroke-width", 1.5)
                  .attr("d", line);
                

                  document.getElementById("alert-container").innerHTML += `
                    <div class="alert alert-warning alert-dismissible fade show" role="alert">
                        <strong>Indicator</strong>: ${lineFilters[i].indicator}<br /><strong>Direction:</strong> ${lineFilters[i].direction}
                        <button onclick="removeLine({'indicator':'${lineFilters[i].indicator}','direction':'${lineFilters[i].direction}'})" type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                `;
                  
              }
      }
      function getRandomColor() {
          var letters = '0123456789ABCDEF';
          var color = '#';
          for (var i = 0; i < 6; i++) {
            color += letters[Math.floor(Math.random() * 16)];
          }
          return color;
        }

    fetch('http://localhost:3000/api2')
      .then(response => response.text())
      .then(data => {
        // Parse the CSV data
        parsedData = d3.csvParse(data, function(d) {
          return { 
            date: d3.isoParse(d.date),
            value: +d.value,
            indicator: d.indicator,
            direction: d.direction
          };
        });
        
        makeSVG(parsedData);

        // svg.append("path")
        //   .datum(secondLineData)
        //   .attr("fill", "none")
        //   .attr("stroke", "red")
        //   .attr("stroke-width", 1.5)
        //   .attr("d", line);
      })
      .catch(error => console.error('Error fetching data:', error));
  </script>

  <!-- Template Main JS File -->
  <script src="assets/js/main.js"></script>

</body>

</html>